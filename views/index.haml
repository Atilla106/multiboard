!!!
%html
  %head
    %title eistv dashboard

  %script{ :src => "https://api.tiles.mapbox.com/mapbox.js/v2.1.9/mapbox.js" }
  %link{ :href => "https://api.tiles.mapbox.com/mapbox.js/v2.1.9/mapbox.css", :rel => "stylesheet" }

  %body
    :css
      body {
        padding: 0px;
        margin: 0px;
        height: 100vh;
        font-family: Blender, Helvetica Neue, Helvetica, Arial, sans-serif;
        color: rgb(33, 150, 243);
        font-size: 2vh;
      }

      header {
        width: 100%;
        height: 5vh;
        background-color: rgb(33, 150, 243);
      }

      header > img {
        margin-top: 1vh;
        margin-left: 1vh;
        height: 3vh;
      }

      .column {
        position: absolute;
        top: 5vh;
        width: 25%;
      }

      .full {
        height: 95vh;
      }

      #time {
        float: right;
        margin-top: 1vh;
        margin-right: 1vh;
        font-size: 3vh;
      }

      #time-hour {
        color: rgb(244, 172, 47);
      }

      #time-minute {
        color: rgb(98, 108, 115);
      }

      #map {
        left: 0px;
      }

      #trains {
        left: 25%;
      }

      .train {
        width: 100%;
        height: 7.915vh;
        font-size: 2.5vh;
        font-family: Tauri, sans-serif;
      }

      .train:nth-child(odd) {
        background-color: rgb(208, 208, 208);
      }

      .train:nth-child(even) {
        background-color: rgb(223, 223, 223);
      }

      .train-time {
        margin-top: 2.3vh;
        margin-left: 2vh;
        font-size: 3vh;
        display: inline-block;
      }

      .train-terminus {
        margin-left: 1vh;
        display: inline-block;
      }

      .train-type {
        float: right;
        margin-top: 2vh;
        margin-right: 2vh;
        height: 4vh;
        display: inline-block;
      }

      .train-type > img {
        height: 4vh;
      }

      #meteo {
        left: 50%;
        background-color: rgba(230, 230, 230, 0.7);
      }

      #meteo-icon {
        display: block;
        margin-left: auto;
        margin-right: auto;
      }

      #meteo-temperature {
        text-align: center;
        font-size: 8vh;
      }

      #meteo-minmax {
        margin-left: 20%;
        margin-right: 20%;
      }

      #meteo-min {
        float: left;
      }

      #meteo-max {
        float: right;
      }

      #meteo-block {
        position: relative;
        width: 100%;
      }

      #meteo-windspeed {
        position: absolute;
        top: 0px;
        left: 0px;
        width: 50%;
      }

      #meteo-windicon {
        margin-top: 5vh;
        width: 50%;
        margin-left: 25%;
      }

      #meteo-windtext {
        margin-top: -2vh;
        margin-left: 25%;
        font-size: 3vh;
      }

      #meteo-sun {
        position: absolute;
        top: 10vh;
        left: 50%;
        width: 50%;
      }

      .meteo-suntext {
        text-align: center;
      }

      #meteo-table {
        position: absolute;
        top: 65vh;
        left: 15%;
        width: 70%;
      }

      #meteo-table > table {
        width: 100%;
        border-collapse: collapse;
      }

      .bold {
        font-weight: bold;
      }

      tr {
        border-bottom: 1px solid #ccc;
      }

      #twitter {
        left: 75%;
      }

    %header
      %img{ :src => "http://atilla.org/assets/img/logo.png" }
      %span#time
        %span#time-hour
          #{@time.strftime("%H")}
        %span{ :style => "color: black" } :
        %span#time-minute
          = @time.strftime("%M")

    #map.column.full

    #trains.column.full
      - @trains.each do |train|
        .train
          .train-time
            - if train.state
              = train.state
            - else
              = train.time.strftime("%H:%M")
          .train-terminus
            = train.terminus[0..22]
          .train-type
            - if train.type == "A"
              %img{ :src => "http://i.imgur.com/YvzOdHZ.png" }
            - elsif train.type == "L"
              %img{ :src => "http://i.imgur.com/pMt0cSg.png" }

    #meteo.column.full
      %img{ :id => "meteo-icon", :src => @weather.weather_icon }
      #meteo-temperature #{@weather.temperature}°
      #meteo-minmax
        %span#meteo-min
          min. #{@weather.min_temperature}°
        %span#meteo-max
          max. #{@weather.max_temperature}°

      #meteo-block
        #meteo-windspeed
          %img{ :id => "meteo-windicon", :src => "http://i.imgur.com/nY31gOA.png" }
          #meteo-windtext
            #{@weather.wind_speed} m/s

        #meteo-sun
          .meteo-suntext
            Lever : #{@weather.sunrise.strftime("%Hh%M")}
          %br
          .meteo-suntext
            Coucher : #{@weather.sunset.strftime("%Hh%M")}

      #meteo-table
        %table
          %tr
            %td.bold Jour
            %td.bold +1
            %td.bold +2
            %td.bold +3
          %tr
            %td Matin
            - @weather.morning_forecast.each do |temp|
              %td #{temp}°
          %tr
            %td Après-midi
            - @weather.afternoon_forecast.each do |temp|
              %td #{temp}°

    #twitter.column
      %a{ :class => "twitter-timeline", :href => "https://twitter.com/MyEISTI", :data => { :widget_id => "610095605709471744"} }Tweets @MyEISTI

      %script
        !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");

    :javascript
      L.mapbox.accessToken = 'pk.eyJ1IjoiZmxhdnIiLCJhIjoiZWFkYmQ2YTEzZDRhNDg1MmM2ZDYwZjBiNzkxMzRlODIifQ.hVVth3HEgVYI4wyaWw9BQg';
      var map = L.mapbox.map('map', 'mapbox.streets', { zoomControl: false }).setView([49.0351207, 2.0740691], 15);

      L.marker([49.035048, 2.070], {
          icon: L.mapbox.marker.icon({
              'marker-size': 'large',
              'marker-symbol': 'building',
              'marker-color': '#73B1F9'
          })
      }).addTo(map);

      L.marker([49.036182, 2.080174], {
          icon: L.mapbox.marker.icon({
              'marker-size': 'large',
              'marker-symbol': 'rail',
              'marker-color': '#AF3535'
          })
      }).addTo(map);

      L.marker([49.0421646, 2.0712809], {
          icon: L.mapbox.marker.icon({
              'marker-size': 'large',
              'marker-symbol': 'fast-food',
              'marker-color': '#FFBA5E'
          })
      }).addTo(map);

      L.marker([49.03351, 2.073014], {
          icon: L.mapbox.marker.icon({
              'marker-size': 'large',
              'marker-symbol': 'restaurant',
              'marker-color': '#FFC020'
          })
      }).addTo(map);

      L.marker([49.0362825, 2.0761285], {
          icon: L.mapbox.marker.icon({
              'marker-size': 'large',
              'marker-symbol': 'library',
              'marker-color': '#008010'
          })
      }).addTo(map);
